#!/usr/bin/env bash

setup_enviroment() {
    validate_xcode_version
    install_system_basics
    install_brew_dependencies
    install_carthage_dependencies
}

validate_xcode_version() {
    echo "Validating Xcode version..."
    xcode_version=$(xcodebuild -version)
    if ! [[ $xcode_version = *"9.3"* ]]; then
        echo -e "\033[31mYou must have/select Xcode 9.3.0" >&2
        exit 1
    fi
}

install_system_basics() {
    echo "Checking system basics..."
    if ! type "brew" &> /dev/null; then
        echo "Installing brew..."
        eval '/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)'
    fi
}

install_brew_dependencies() {
    echo "Checking brew packages..."
    brew_dependencies=(carthage swiftlint)

    for brew_dependency in "${brew_dependencies[@]}"; do
        if ! brew ls --versions ${brew_dependency} > /dev/null; then
            echo "Installing $brew_dependency..."
            brew install $brew_dependency
        fi
    done
}

install_carthage_dependencies() {
    echo "Running carthage..."
    carthage bootstrap --platform iOS
}


setup_enviroment
